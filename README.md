# CG-Mode
CG Mode Extension for SillyTavern

一个用于SillyTavern的扩展，可以根据聊天内容自动切换背景图片、背景音乐和环境音效，增强角色扮演的沉浸感。

功能特性

🖼️ 自动背景切换

· 支持CG（立绘隐藏）和BG（立绘显示）两种模式
· 通过世界书中的 [CG:图片名] 和 [BG:图片名] 标签自动切换
· 移动端和桌面端可设置不同的图片文件夹
· 支持多种图片格式：PNG、JPG、JPEG、GIF、WEBP、BMP

🎵 音频管理

· 自动播放背景音乐（BGM）通过 [BGM:音乐名] 标签
· 自动播放环境音效（AMB）通过 [AMB:音效名] 标签
· 音频淡入淡出效果，平滑过渡
· 与SillyTavern的音频系统集成

⌨️ 斜杠命令

· /setcg 图片名 - 手动设置CG图片
· /setbg 图片名 - 手动设置BG图片

安装方法

1. 将扩展文件放入SillyTavern的扩展目录：
   ```
   scripts/extensions/third-party/CG-Mode/
   ```
2. 重启SillyTavern或重新加载页面

配置说明

基本设置

· 启用扩展：开启或关闭CG模式功能
· 扫描消息数量：设置扫描最近多少条消息中的世界书标签（默认2条）
· 资源服务器地址：存放图片和音频文件的服务器URL

文件夹配置

· 桌面端CG文件夹：桌面设备专用的CG图片文件夹
· 桌面端BG文件夹：桌面设备专用的BG图片文件夹
· 移动端CG文件夹：移动设备专用的CG图片文件夹
· 移动端BG文件夹：移动设备专用的BG图片文件夹

文件命名规则

· 图片文件只需提供名称，扩展名会自动匹配
· 示例：世界书中使用 [CG:scene1]，实际文件可以是 scene1.png、scene1.jpg 等

使用方法

自动模式

在世界书中使用以下标签：

```
[CG:场景图片名]      # 切换为CG模式，隐藏立绘
[BG:背景图片名]      # 切换为BG模式，显示立绘  
[BGM:背景音乐名]     # 播放指定背景音乐
[AMB:环境音效名]     # 播放指定环境音效
```

手动模式

在聊天窗口中使用斜杠命令：

```
/setcg 场景图片名     # 手动切换到CG图片
/setbg 背景图片名     # 手动切换到BG图片
```

文件结构要求

```
资源服务器/
├── cg/              # CG图片文件夹（可选）
│   ├── scene1.png
│   └── scene2.jpg
├── bg/              # BG图片文件夹（可选）
│   ├── location1.png
│   └── location2.jpg
└── 根目录图片文件      # 也可直接放在根目录
```

注意事项

1. 服务器配置：确保资源服务器允许跨域访问（CORS）
2. 文件存在性：扩展会自动检查文件是否存在，找不到文件时会显示警告
3. 音频集成：BGM和AMB需要先在SillyTavern的音频管理中导入
4. 性能优化：图片会预加载，避免切换时的延迟

故障排除

· 连接测试：使用设置中的"测试连接"按钮检查服务器可达性
· 控制台日志：查看浏览器控制台获取详细调试信息
· 文件路径：确认文件夹配置正确，文件名不含扩展名

更新日志

v1.0

· 初始版本发布
· 支持自动背景切换和音频播放
· 添加斜杠命令支持

---

如有问题或建议，请访问项目仓库提交Issue。
